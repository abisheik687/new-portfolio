{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Abisheik/new%20portfolio/new-portfolio/src/app/api/chat/query/route.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { NextResponse } from 'next/server';\r\n\r\n// Initialize Supabase Client\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\r\nconst supabase = createClient(supabaseUrl, supabaseKey);\r\n\r\n// Initialize Gemini Client\r\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || '');\r\nconst embeddingModel = genAI.getGenerativeModel({ model: \"text-embedding-004\" });\r\nconst chatModel = genAI.getGenerativeModel({ model: \"gemini-2.0-flash\" });\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const { query } = await req.json();\r\n\r\n        if (!query) {\r\n            return NextResponse.json({ error: 'Query is required' }, { status: 400 });\r\n        }\r\n\r\n        // 1. Generate Embedding for the Query\r\n        const embeddingResult = await embeddingModel.embedContent(query);\r\n        const queryEmbedding = embeddingResult.embedding.values;\r\n\r\n        // 2. Search for Matching Documents in Supabase\r\n        const { data: documents, error: searchError } = await supabase.rpc('match_documents', {\r\n            query_embedding: queryEmbedding,\r\n            match_threshold: 0.3, // Adjust threshold as needed\r\n            match_count: 5,\r\n        });\r\n\r\n        if (searchError) {\r\n            console.error('Supabase search error:', searchError);\r\n            return NextResponse.json({ error: 'Failed to search documents' }, { status: 500 });\r\n        }\r\n\r\n        // 3. Construct Context from Matched Documents\r\n        const contextText = documents\r\n            ?.map((doc: any) => `---\\nSource: ${doc.id}\\nContent: ${doc.content}\\n---`)\r\n            .join('\\n\\n');\r\n\r\n        const systemPrompt = `You are an AI assistant for Abisheik S's portfolio website.\r\nYour goal is to answer questions about Abisheik's experience, projects, and skills based ONLY on the provided context.\r\n\r\nContext:\r\n${contextText || \"No relevant context found.\"}\r\n\r\nInstructions:\r\n- Answer the user's question clearly and concisely.\r\n- Use the provided context to support your answer.\r\n- If the answer is not in the context, say \"I don't have that information in my knowledge base.\"\r\n- Do not hallucinate or make up facts.\r\n- Be professional, friendly, and enthusiastic.\r\n- If you cite a specific project or experience, mention it clearly.\r\n`;\r\n\r\n        // 4. Generate Answer using Gemini Chat\r\n        const result = await chatModel.generateContent([systemPrompt, query]);\r\n        const response = await result.response;\r\n        const answer = response.text();\r\n\r\n        return NextResponse.json({\r\n            answer,\r\n            sources: documents?.map((doc: any) => ({ id: doc.id, content: doc.content })),\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('RAG API Error:', error);\r\n        return NextResponse.json(\r\n            { error: error.message || 'Internal Server Error' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEA,6BAA6B;AAC7B,MAAM;AACN,MAAM;AACN,MAAM,WAAW,CAAA,GAAA,yLAAA,CAAA,eAAY,AAAD,EAAE,aAAa;AAE3C,2BAA2B;AAC3B,MAAM,QAAQ,IAAI,gKAAA,CAAA,qBAAkB,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI;AACnE,MAAM,iBAAiB,MAAM,kBAAkB,CAAC;IAAE,OAAO;AAAqB;AAC9E,MAAM,YAAY,MAAM,kBAAkB,CAAC;IAAE,OAAO;AAAmB;AAEhE,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;QAEhC,IAAI,CAAC,OAAO;YACR,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,sCAAsC;QACtC,MAAM,kBAAkB,MAAM,eAAe,YAAY,CAAC;QAC1D,MAAM,iBAAiB,gBAAgB,SAAS,CAAC,MAAM;QAEvD,+CAA+C;QAC/C,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,mBAAmB;YAClF,iBAAiB;YACjB,iBAAiB;YACjB,aAAa;QACjB;QAEA,IAAI,aAAa;YACb,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,8CAA8C;QAC9C,MAAM,cAAc,WACd,IAAI,CAAC,MAAa,CAAC,aAAa,EAAE,IAAI,EAAE,CAAC,WAAW,EAAE,IAAI,OAAO,CAAC,KAAK,CAAC,EACzE,KAAK;QAEV,MAAM,eAAe,CAAC;;;;AAI9B,EAAE,eAAe,6BAA6B;;;;;;;;;AAS9C,CAAC;QAEO,uCAAuC;QACvC,MAAM,SAAS,MAAM,UAAU,eAAe,CAAC;YAAC;YAAc;SAAM;QACpE,MAAM,WAAW,MAAM,OAAO,QAAQ;QACtC,MAAM,SAAS,SAAS,IAAI;QAE5B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACrB;YACA,SAAS,WAAW,IAAI,CAAC,MAAa,CAAC;oBAAE,IAAI,IAAI,EAAE;oBAAE,SAAS,IAAI,OAAO;gBAAC,CAAC;QAC/E;IAEJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACpB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAClD;YAAE,QAAQ;QAAI;IAEtB;AACJ","debugId":null}}]
}